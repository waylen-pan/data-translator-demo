# Agents Instructions（所有项目通用）

## 沟通与协作
- 使用中文回答
- 非必要不使用花里胡哨的Markdown回复我，清楚、明了才是关键
- 任务汇报与总结应在聊天中完成，而非创建文件。严禁在未经用户明确要求的情况下，创建任何 .md 文件来报告、总结或记录任务过程。这种行为会制造不必要的“垃圾文件”，污染项目。
- 任务完成后不要新增任何非必要的总结文档和说明文档md，除非用户主动、明确要求；README.md 等常规文档需要正常按照规范写入和及时更新
- 写入plan的时候请始终使用中文
- 和你交流协作的人类是一位AIPM

## 代码规范与注释
- 所有代码应该使用中文尽可能清楚地注释，方便人类review相关流程/逻辑
- 每次对代码文件进行修改后，都应该主动检查修改后代码是否有错误（验证完整性和语法错误）
- 本工作区是独立开发者的项目
- 当“Demo 不考虑向后兼容”与“遵循最佳实践、可维护、可持续、可拓展”发生冲突时，优先选择最佳实践；Demo 快速试验为次要目标。
- “不考虑向后兼容”的方法论含义（让系统更清晰，而不是更“能凑合跑”）：
  - 适用范围：数据库/数据模型、API/前后端契约、函数/类/模块命名、配置项/env、文件与数据格式、Prompt/协议等所有“对外或对内的契约”。
  - 执行方式：当需求演进需要升级结构/命名/契约时，在一次改动中完成“统一升级”——同步更新所有调用方（前端/后端/脚本/测试/文档/配置），并删除旧实现与旧入口，保证系统内只存在一套权威版本。
  - 明确避免：为了兼容而保留旧字段/旧表/旧路由、旧函数名套壳/别名、同时支持 v1/v2 两套行为、双解析/双映射的分叉逻辑；除非用户明确要求或确认需要短期过渡（过渡范围需最小化，并在完成后及时清理）。
- 实现新功能或者新需求时，应遵循相关开发范式的最佳实践，便于可持续地拓展、维护、迭代、更新；而不能追求“最小改动”。

## Git 与版本控制
- 只有在用户明确要求提交本地/远程commit的时候，才能提交commit，禁止在没有用户主动要求的情况下提交commit，每一次都需要用户允许
- 提交仓库或者推送分支的时候，永远不要提交.env
- 每次提交commit时，都要清楚说明为什么做、做了什么、怎么做、结果如何
- 禁止未经确认使用 `gh repo sync --force` 等会重置远端历史/本地历史的危险操作
- 遇到 gh repo clone 提示找不到仓库时，尝试执行 `gh auth status` 查看账号，再用 `gh auth switch -u <账号>` 切换后重试克隆
- 在修改代码前，请先遵循仓库中可能存在的版本管理规范（例如检查AGENTS.md或类似文档）

## 项目结构与环境
- 避免把文件直接生成/写入到根目录，除非这遵循最佳实践
- 不要随意删除/清空文件，除非用户明确主动清晰要求，否则请二次确认
- 所有demo项目的用途是用于给AIPM做效果评估和调优测试，自用为主
- 所有项目都应该在对应目录下创建/使用 venv；执行任何 Python 相关命令（python/pip/pytest/ruff/uvicorn 等）前必须先激活 venv，并用 `which python` 或 `python -c 'import sys; print(sys.executable)'` 确认解释器路径
- 所有demo项目都应该安装和使用 Python 3.12 虚拟环境（除非用户特别说明）
- google-genai Google Gen AI SDK必须使用1.52.0以上的最新版本
- OpenAI SDK 必须使用2.8.1以上的最新版本
- 了解历史开发过程优先阅读 Git commit 记录；必要时再参考 README.md 和代码本身（以当前仓库实际内容为准）

## 工具与操作
- 当需要增/删/改/读.env或者类配置文件、类敏感文件的时候，请使用终端命令而不是常规阅读工具（无法生效）
- 配置/敏感文件（如 .env、.gitignore、Dockerfile、.env.example）默认授权增删改无需二次确认，须用终端命令操作以避免工具限制。
- .env/.env.example 尽量避免写入非必要注释，保持干净简洁
- 使用你觉得最擅长、准确的方式/工具来执行增/删/改代码
- 终端里优先用 `python3`（`python` 可能不存在）
- 写入To-dos的时候请使用中文，便于人类实时查看进度
- 在开发过程中，代码可能会被人类或其他AI改动，从而因上下文不匹配导致 apply_patch 失败。
- 涉及“磁盘路径”（数据库文件、上传素材存储目录、缓存目录等）时，使用相对路径，便于在不同实例/环境运行
- 本项目 Python 虚拟环境固定在 `backend/venv`（不要在仓库根目录创建 `venv/`）
- 执行任何 Python 相关命令请在虚拟环境运行
- 对于前端的测试，除了代码的单元测试外，对于UI效果的调试，你可以考虑使用"chrome-devtools"；常规review尽量不要使用这个工具，因为非常耗时。
- 强烈建议阅读本地最近 5 个 commit 的完整说明来了解历史开发背景；需求/功能变更的解释与决策优先写在 commit message（本项目以 commit 记录为准）


## Prompt设计/优化/增删改/迭代

- 修改业务用到的prompt时，除非用户特别说明或者提出其他要求，否则应该遵循：尽可能不要大范围重写；对于一个新增的指令或说明，如果有什么地方是可以和原来的指令融合在一起，那么就融合；或者如果有什么地方是和原来的指令有冲突，那就把原来冲突的地方去掉/修改；避免过于分散和存在前后冲突
- 在对prompt进行修改，应该从第一性原理出发，为什么要修改-修改是为了解决什么问题-导致这个问题发生的最根本原因是什么-应该如何优化或者解决对应的prompt；不要头疼医头脚疼医脚。
- 当思考和设计方案时，尽可能不要引入非必要复杂度（如何理解非必要复杂度：假设在LLM模型层能力上升20%以及token成本下降50% 的情况下；此时如果这个方案就会变得无法带来增益或者可能导致负优化的话，这就是非必要复杂度，类似这个方向去思考）
- 在对prompt进行修改，应该从第一性原理出发，为什么要修改-修改是为了解决什么问题-导致这个问题发生的最根本原因是什么-应该如何优化或者解决对应的prompt；不要头疼医头脚疼医脚。尽量避免说去对prompt 做那些“禁止xx、避免xx” 的优化/修改，这种写出来的prompt 会非常脆弱。 
- 当思考和设计方案时，尽可能不要引入非必要复杂度（如何理解非必要复杂度：假设在LLM模型层能力上升20%以及token成本下降50% 的情况下；此时如果这个方案就会变得无法带来增益或者可能导致负优化的话，这就是非必要复杂度，类似这个方向去思考） 
- 用prompt 用context 告诉模型 传递信息、方法论 但是决策和动作仍然由模型去输出和操作
- 不要有历史包袱 不要有路径依赖思考



## 数据分析
- 在对任何jsonl、csv、xlsx进行分析时，都应该使用临时脚本/终端命令，并且在阅读具体内容或者行列时限制每个字段/每行打印出来的字符串长度，排查问题时优先只看字段名/长度/前 N 字符（如 200），避免把整段文本直接打印导致上下文被挤爆。